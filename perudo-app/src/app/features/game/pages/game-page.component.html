<div class="game-container" *ngIf="gameState">
  <!-- Header -->
  <div class="game-header">
    <h1 class="game-title">üé≤ Perudo</h1>
    <button (click)="backToMenu()" class="btn-back">Menu</button>
  </div>

  <!-- Phase du jeu -->
  <div class="phase-banner" [class.palifico]="gameState.isPalifico">
    <span>{{ phaseMessage }}</span>
    <span *ngIf="gameState.isPalifico" class="palifico-warning">
      Pas de jokers ! Seule la quantit√© peut augmenter.
    </span>
  </div>

  <!-- Phase de jeu normale -->
  <div *ngIf="gameState.phase === GamePhase.BIDDING" class="game-content">
    <!-- Joueur actuel -->
    <div class="current-player-section">
      <h2 class="section-title">Vos d√©s ({{ currentPlayer?.name }})</h2>
      <div class="dice-container">
        <app-die
          *ngFor="let die of currentPlayerDice"
          [value]="die.value"
          [isVisible]="true"
          size="large"
        ></app-die>
      </div>
    </div>

    <!-- Ench√®re actuelle -->
    <div *ngIf="gameState.currentBid" class="current-bid-section">
      <h3>Ench√®re actuelle</h3>
      <div class="current-bid">
        <span class="bid-quantity">{{ gameState.currentBid.quantity }}</span>
        <span class="bid-label">√ó</span>
        <app-die [value]="gameState.currentBid.value" [isVisible]="true" size="medium"></app-die>
      </div>
    </div>

    <!-- Contr√¥les d'ench√®re -->
    <div class="bid-controls">
      <h3>Votre ench√®re</h3>
      <div class="bid-inputs">
        <div class="input-group">
          <label>Quantit√©</label>
          <input
            type="number"
            [(ngModel)]="bidQuantity"
            min="1"
            [max]="gameStateService.getTotalDiceCount()"
            class="bid-input"
          />
        </div>

        <span class="multiplier">√ó</span>

        <div class="input-group">
          <label>Valeur</label>
          <select [(ngModel)]="bidValue" class="bid-select">
            <option *ngFor="let value of dieValues" [value]="value">
              {{ value }} {{ value === 1 ? '(As)' : '' }}
            </option>
          </select>
        </div>
      </div>

      <div class="action-buttons">
        <button
          (click)="placeBid()"
          [disabled]="!isBidValid"
          class="btn-bid"
        >
          Ench√©rir
        </button>
        <button
          (click)="callDudo()"
          [disabled]="!gameState.currentBid"
          class="btn-dudo"
        >
          DUDO !
        </button>
        <button
          (click)="callCalza()"
          [disabled]="!gameState.currentBid"
          class="btn-calza"
          title="Pari que l'ench√®re est exactement correcte"
        >
          CALZA !
        </button>
      </div>
    </div>

    <!-- Autres joueurs -->
    <div class="other-players-section">
      <h3 class="section-title">Autres joueurs</h3>
      <div class="players-grid">
        <app-player-card
          *ngFor="let player of otherPlayers"
          [player]="player"
          [showDice]="false"
          [isCompact]="true"
        ></app-player-card>
      </div>
    </div>
  </div>

  <!-- Phase Dudo Challenge -->
  <div *ngIf="gameState.phase === GamePhase.DUDO_CHALLENGE && gameState.lastDudoResult" class="dudo-result">
    <h2 class="result-title">
      {{ gameState.lastDudoResult.isCalza ? 'üéØ CALZA !' : 'R√©sultat du DUDO' }}
    </h2>

    <div class="result-info" [class.calza]="gameState.lastDudoResult.isCalza">
      <p class="result-text">
        Ench√®re: <strong>{{ gameState.lastDudoResult.challengedBid.quantity }}√ó
        {{ gameState.lastDudoResult.challengedBid.value }}</strong>
      </p>
      <p class="result-text">
        Nombre r√©el: <strong>{{ gameState.lastDudoResult.actualCount }}</strong>
      </p>

      <p *ngIf="gameState.lastDudoResult.isCalza" class="result-verdict calza">
        üéâ Pile poil ! Le joueur qui a fait l'ench√®re gagne un d√© !
      </p>
      <p *ngIf="!gameState.lastDudoResult.isCalza" class="result-verdict" [class.correct]="gameState.lastDudoResult.wasCorrect">
        {{ gameState.lastDudoResult.wasCorrect ? '‚úì Challenge r√©ussi !' : '‚úó Challenge √©chou√© !' }}
      </p>
    </div>

    <div class="all-dice">
      <h3>Tous les d√©s r√©v√©l√©s:</h3>
      <div class="dice-container">
        <app-die
          *ngFor="let die of gameState.lastDudoResult.allDice"
          [value]="die.value"
          [isVisible]="true"
          size="medium"
        ></app-die>
      </div>
    </div>

    <button (click)="continueGame()" class="btn-continue">
      Continuer
    </button>
  </div>

  <!-- Phase Game Over -->
  <div *ngIf="gameState.phase === GamePhase.GAME_OVER" class="game-over">
    <h2 class="game-over-title">üèÜ Partie termin√©e !</h2>
    <p class="winner-announcement">
      <strong>{{ winner?.name }}</strong> remporte la partie !
    </p>
    <button (click)="newGame()" class="btn-new-game">
      Nouvelle partie
    </button>
  </div>
</div>
